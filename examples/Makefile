CC			= gcc
CFLAGS			= -c -Wall -Wextra -Wfatal-errors -Wno-unused-function
SRCDIR 			= .
DEBUGOUTPUTDIR 		= build/debug
RELEASEOUTPUTDIR	= build/release
EXAMPLE_UDP_SOURCES	= e_example_udp.c
EXAMPLE_RTP_SOURCES	= e_example_rtp.c
INCLUDES		= -I. -I../include
LIBS			= -lendpoint -pthread
_EXAMPLE_UDP_OBJECTS		= $(EXAMPLE_UDP_SOURCES:.c=.o)
EXAMPLE_UDP_DEBUGOBJECTS 	= $(patsubst %,$(DEBUGOUTPUTDIR)/%,$(_EXAMPLE_UDP_OBJECTS))
EXAMPLE_UDP_RELEASEOBJECTS 		= $(patsubst %,$(RELEASEOUTPUTDIR)/%,$(_EXAMPLE_UDP_OBJECTS))
EXAMPLE_UDP_DEBUGTARGET		= build/debug/e-example-udp
EXAMPLE_UDP_RELEASETARGET	= build/release/e-example-udp
_EXAMPLE_RTP_OBJECTS		= $(EXAMPLE_RTP_SOURCES:.c=.o)
EXAMPLE_RTP_DEBUGOBJECTS 	= $(patsubst %,$(DEBUGOUTPUTDIR)/%,$(_EXAMPLE_RTP_OBJECTS))
EXAMPLE_RTP_RELEASEOBJECTS 		= $(patsubst %,$(RELEASEOUTPUTDIR)/%,$(_EXAMPLE_RTP_OBJECTS))
EXAMPLE_RTP_DEBUGTARGET		= build/debug/e-example-rtp
EXAMPLE_RTP_RELEASETARGET	= build/release/e-example-rtp

debugprereqs:
		mkdir -p $(DEBUGOUTPUTDIR)

releaseprereqs:
		mkdir -p $(RELEASEOUTPUTDIR)

debugall:	debugprereqs $(EXAMPLE_UDP_SOURCES) $(EXAMPLE_UDP_DEBUGTARGET) $(EXAMPLE_RTP_SOURCES) $(EXAMPLE_RTP_DEBUGTARGET)
releaseall:	releaseprereqs $(EXAMPLE_UDP_SOURCES) $(EXAMPLE_UDP_RELEASETARGET) $(EXAMPLE_RTP_SOURCES) $(EXAMPLE_RTP_RELEASETARGET)

# additional flags
# CONFIG_DEBUG_LIST	- extensive debugging of list with external debugging
# 			functions
examples-debug:		CFLAGS += -DDEBUG -g -ggdb3 -O0
examples-debug:		debugall

examples-release:	CFLAGS += -DNDEBUG
examples-release: 	releaseall

examples:		examples-release


$(EXAMPLE_UDP_DEBUGTARGET): $(EXAMPLE_UDP_DEBUGOBJECTS) 
	$(CC) $(LDFLAGS) $(EXAMPLE_UDP_DEBUGOBJECTS) $(LIBS) -o $@

$(EXAMPLE_UDP_RELEASETARGET): $(EXAMPLE_UDP_RELEASEOBJECTS) 
	$(CC) $(LDFLAGS) $(EXAMPLE_UDP_RELEASEOBJECTS) $(LIBS) -o $@

$(EXAMPLE_RTP_DEBUGTARGET): $(EXAMPLE_RTP_DEBUGOBJECTS) 
	$(CC) $(LDFLAGS) $(EXAMPLE_RTP_DEBUGOBJECTS) $(LIBS) -o $@

$(EXAMPLE_RTP_RELEASETARGET): $(EXAMPLE_RTP_RELEASEOBJECTS) 
	$(CC) $(LDFLAGS) $(EXAMPLE_RTP_RELEASEOBJECTS) $(LIBS) -o $@

$(DEBUGOUTPUTDIR)/%.o: $(SRCDIR)/%.c
	$(CC) $(CFLAGS) $(INCLUDES) $< -o $@

$(RELEASEOUTPUTDIR)/%.o: $(SRCDIR)/%.c
	$(CC) $(CFLAGS) $(INCLUDES) $< -o $@

.c.o:
	$(CC) $(CFLAGS) $(INCLUDES) $< -o $@

all: examples-release

.DEFAULT_GOAL = examples-release

clean:
	rm -rf $(EXAMPLE_UDP_DEBUGOBJECTS) $(EXAMPLE_UDP_DEBUGTARGET) $(EXAMPLE_RTP_DEBUGOBJECTS) $(EXAMPLE_RTP_DEBUGTARGET)
	rm -rf $(EXAMPLE_UDP_RELEASEOBJECTS) $(EXAMPLE_UDP_RELEASETARGET) $(EXAMPLE_RTP_RELEASEOBJECTS) $(EXAMPLE_RTP_RELEASETARGET)
